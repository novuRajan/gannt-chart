var Gantt=function(){"use strict";const t="http://www.w3.org/2000/svg";function e(e,n,a){const s=document.createElementNS(t,"g");s.classList.add("lines"),e.appendChild(s);for(let e=0;e<=n;e+=50){const n=document.createElementNS(t,"line");n.setAttribute("x1",e),n.setAttribute("x2",e),n.setAttribute("y1",35),n.setAttribute("y2",40*a+40),n.classList.add("grid-line"),s.appendChild(n)}}function n(e,n,a){const s=document.createElementNS(t,"g");s.classList.add("month"),e.appendChild(s);const i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let r=-1;for(let e=0;e<=a;e+=50){const a=new Date(n.startingDate.getTime()+e/50*864e5).getMonth();if(a!==r){r=a;const n=document.createElementNS(t,"text");n.setAttribute("x",e),n.setAttribute("y",15),n.classList.add("month-heading"),n.textContent=i[r],s.appendChild(n)}}}function a(e,n,a,s){const i=document.createElementNS(t,"g");e.appendChild(i),i.classList.add("date");const r=document.createElementNS(t,"text");r.setAttribute("x","0"),r.setAttribute("y",s),i.appendChild(r);for(let e=0;e<=a;e+=50){const a=new Date(n.startingDate.getTime()+e/50*864e5),r=document.createElementNS(t,"text");r.setAttribute("x",e-3),r.setAttribute("y",s+25),r.textContent=a.getDate(),i.appendChild(r)}}const s=t=>{const e=new Map(t.map((t=>[t.id,t])));t.forEach((t=>{i(t,e),function(t){if(t.subTask&&t.subTask.length>0){const e=new Map(t.subTask.map((t=>[t.id,t])));t.subTask.forEach((n=>{const a=(new Date(n.end)-new Date(n.start))/864e5;if(new Date(n.start)<new Date(t.start))n.start=t.start,n.end=new Date(new Date(n.start).setDate(new Date(t.start).getDate()+a)).toISOString().split("T")[0];else{const e=(new Date(n.start)-new Date(t.start))/864e5;n.start=new Date(new Date(n.start).setDate(new Date(t.start).getDate()+e)).toISOString().split("T")[0]}i(n,e),n.end>t.end&&(t.end=n.end)}))}}(t)}))};function i(t,e){if(0===t.dependencies.length)return;const n=t.dependencies.map((t=>e.get(t))),a=new Date(Math.max(...n.map((t=>new Date(t.end)))));n.forEach((n=>{i(n,e);const s=(new Date(t.end)-new Date(t.start))/864e5;new Date(t.start)<a&&(t.start=a.toISOString().split("T")[0],t.end=new Date(new Date(t.start).setDate(new Date(t.start).getDate()+s)).toISOString().split("T")[0])}))}const r=document.createElement("div");function d(t){t.style.display="none"}function o(t){let e=document.getElementById("addFormModal");e||(e=document.createElement("div"),e.setAttribute("id","addFormModal"),e.setAttribute("class","modal"),document.body.appendChild(e));let n=document.getElementById("addTaskForm");n||(n=document.createElement("form"),n.setAttribute("id","addTaskForm"),e.appendChild(n)),n.innerHTML="",c("Task Name:","taskName","","text",!0,n),c("Start Date:","startDate","","date",!0,n),c("End Date:","endDate","","date",!0,n),c("Progress:","progress","","number",!0,n);const a=document.createElement("button");a.setAttribute("type","button"),a.textContent="Save Changes",a.addEventListener("click",(function(){!function(t){const e=document.getElementById("addFormModal"),n=document.getElementById("taskName").value,a=document.getElementById("startDate").value,s=document.getElementById("endDate").value;if(!n||!a||!s)return void alert("Please fill in all fields.");const i={id:t.length+1,name:n,start:a,end:s,progress:0,dependencies:[]};t.push(i),length+=1,d(e),g.createChart(t)}(t)})),n.appendChild(a);const s=document.createElement("button");s.setAttribute("type","button"),s.textContent="Cancel",s.addEventListener("click",(function(){d(e)})),n.appendChild(s),e.style.display="block",event.preventDefault()}function u(t,e,n,a=null){t.preventDefault(),g.stopDrag();let i=document.getElementById("editModal");i||(i=document.createElement("div"),i.setAttribute("id","editModal"),i.setAttribute("class","modal"),document.body.appendChild(i));let r=document.getElementById("editTaskForm");r||(r=document.createElement("form"),r.setAttribute("id","editTaskForm"),i.appendChild(r)),r.innerHTML="",c("Task Name:","editTaskName",e.name,"text",!0,r),c("Start Date:","editStartDate",e.start,"date",!0,r),c("End Date:","editEndDate",e.end,"date",!0,r),c("Progress:","editProgress",e.progress,"number",!0,r);const o=document.createElement("select");o.setAttribute("id","editDependencies"),o.setAttribute("multiple","multiple"),r.appendChild(o),n.forEach((t=>{if(t.id!==e.id&&!l(e,t,n)){const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.dependencies.includes(t.id)&&(n.selected=!0),o.appendChild(n)}})),r.setAttribute("data-task-id",e.id);const u=document.createElement("button");u.setAttribute("type","button"),u.textContent="Save Changes",u.addEventListener("click",(function(){!function(t,e=null){const n=document.getElementById("editTaskForm"),a=document.getElementById("editTaskName"),i=document.getElementById("editStartDate"),r=document.getElementById("editEndDate"),d=document.getElementById("editProgress"),o=document.getElementById("editDependencies"),u=a.value,c=i.value,l=r.value,h=d.value,m=parseInt(n.getAttribute("data-task-id"),10),p=Array.from(o.selectedOptions).map((t=>parseInt(t.value,10))),b=t.findIndex((t=>t.id===m));-1!==b&&(t[b].name=u,t[b].start=c,t[b].end=l,t[b].progress=h>100?100:h,t[b].dependencies=p);s(t),e?g.createChart(e):g.createChart(t)}(n,a),d(i)})),r.appendChild(u);const h=document.createElement("button");h.setAttribute("type","button"),h.textContent="Cancel",h.addEventListener("click",(function(){d(i)})),r.appendChild(h),i.style.display="block",t.preventDefault()}function c(t,e,n,a,s,i){const r=document.createElement("label");r.setAttribute("for",e),r.textContent=t;const d=document.createElement("input");d.setAttribute("type",a),d.setAttribute("id",e),d.setAttribute("name",e),d.value=n,d.required=s,i.appendChild(r),i.appendChild(d)}function l(t,e,n){return e.dependencies.includes(t.id)||e.dependencies.some((e=>l(t,n[e-1],n)))}function h(t,e){const n=t.dependencies.map((t=>e[t-1].name)),a=n.length>0?`Dependencies: ${n.join(", ")}`:"";r.innerHTML=`\n    Task: ${t.name}<br>\n    Start: ${t.start}<br>\n    End: ${t.end}<br>\n    ${a}\n    `,r.style.left=`${event.pageX}px`,r.style.top=`${event.pageY}px`,r.style.display="block"}function m(){r.style.display="none"}r.className="bar-hover",document.body.appendChild(r);const p="http://www.w3.org/2000/svg";class g{constructor(){this.dateInfo,this.taskCount,this.isDragging=!1,this.initialX,this.initialWidth,this.isDragStart,this.currentTaskRect,this.currentProgressRect,this.dragMoveListener=null,this.length,this.dependentTask,this.tasks,this.allTask}getTotalLength(t){return t.reduce(((t,e)=>t+1+(e.subTask?this.getTotalLength(e.subTask):0)),0)}createGanttChart(t){s(t);const e=document.getElementById("chart"),n=document.createElement("button");n.setAttribute("class","add-button"),n.textContent="Add Task",n.addEventListener("click",(()=>{o(t)}));let a=e.querySelector("svg");a?this.updateGanttChartContent(a,t):(e.appendChild(n),a=this.createSVG(t),e.appendChild(a))}createSVG(t){const s=document.createElementNS(p,"svg");s.setAttribute("min-width","100%"),s.setAttribute("height","200%");const i=document.createElementNS(p,"g");i.setAttribute("class","date-groups"),s.appendChild(i),this.dateInfo=this.calculateDateInfo(t);const r=this.calculateChartWidth(this.dateInfo);return this.length=this.getTotalLength(t),s.setAttribute("viewBox",`0 0 ${r} ${40*this.length+40}`),e(i,r,this.length),n(i,this.dateInfo,r),a(i,this.dateInfo,r,this.length),this.createTaskBars(s,t,this.dateInfo),s}calculateDateInfo(t){const e=t.map((t=>new Date(t.start))),n=t.map((t=>new Date(t.end))),a=new Date(Math.min(...e)),s=new Date(a);s.setDate(a.getDate()-5);const i=new Date(Math.max(...n)),r=(i-a)/864e5;return{startingDate:s,maxDate:i,multiplier:r>100?54:r>30?60:120}}calculateChartWidth(t){return t.multiplier*((t.maxDate-t.startingDate)/864e5)}createTaskBars(t,e,n){let a=0;e.forEach(((s,i)=>{const r=document.createElementNS(p,"g");r.setAttribute("class","tasks"),t.appendChild(r);const d=Math.max(...s.dependencies.map((t=>new Date(e[t-1].end)))),o=Math.max((d-n.startingDate)/864e5*50,(new Date(s.start)-n.startingDate)/864e5*50),c=(new Date(s.end)-new Date(s.start))/864e5*50,l=document.createElementNS(p,"rect");l.setAttribute("x",o),l.setAttribute("y",40*a+40),l.setAttribute("width",c),l.setAttribute("height",30),l.setAttribute("fill","#3498db"),r.appendChild(l);const g=c*s.progress/100,b=document.createElementNS(p,"rect");b.setAttribute("x",o),b.setAttribute("y",40*a+40),b.setAttribute("width",g),b.setAttribute("height",30),b.setAttribute("fill","#2ecc71"),r.appendChild(b);const D=document.createElementNS(p,"text");if(D.setAttribute("x",o+5),D.setAttribute("y",40*a+60),D.textContent=s.name,r.appendChild(D),s.subTask&&s.subTask.length>0){const t=document.createElementNS(p,"g");t.setAttribute("class","subtask"),r.appendChild(t),s.subTask.forEach(((i,r)=>{const d=Math.max(...i.dependencies.map((t=>new Date(s.subTask[t-1].end)))),o=Math.max((d-n.startingDate)/864e5*50,(new Date(i.start)-n.startingDate)/864e5*50),c=(new Date(i.end)-new Date(i.start))/864e5*50,l=document.createElementNS(p,"rect");l.setAttribute("class","subtask"),l.setAttribute("x",o),l.setAttribute("y",40*(r+a+1)+40),l.setAttribute("width",c),l.setAttribute("height",15),l.setAttribute("fill","#e74c3c"),t.appendChild(l);const g=c*i.progress/100,b=document.createElementNS(p,"rect");b.setAttribute("class","subtask-progress"),b.setAttribute("x",o),b.setAttribute("y",40*(r+a+1)+40),b.setAttribute("width",g),b.setAttribute("height",15),b.setAttribute("fill","#c0392b"),t.appendChild(b);const D=document.createElementNS(p,"text");D.setAttribute("x",o+5),D.setAttribute("y",40*(r+a+1)+50),D.textContent=i.name,D.setAttribute("font-size","10px"),t.appendChild(D),D.addEventListener("mouseover",(()=>h(i,s.subTask))),l.addEventListener("mouseover",(()=>h(i,s.subTask))),l.addEventListener("mouseout",m),b.addEventListener("mouseover",(()=>h(i,s.subTask))),b.addEventListener("mouseout",m),l.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,i,s.subTask,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,i,s.subTask,e)})),D.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,i,s.subTask,e)})),l.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,i,s.subTask,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,i,s.subTask,e)})),D.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,i,s.subTask,e)}))}))}D.addEventListener("mouseover",(()=>h(s,e))),l.addEventListener("mouseover",(()=>h(s,e))),l.addEventListener("mouseout",m),b.addEventListener("mouseover",(()=>h(s,e))),b.addEventListener("mouseout",m),l.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,s,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,s,e)})),D.addEventListener("contextmenu",(t=>{t.preventDefault(),u(t,s,e)})),l.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,s,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,s,e)})),D.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,l,b,s,e)})),document.addEventListener("mouseup",(t=>{document.removeEventListener("mousemove",this.dragMoveListener),this.handleMouseUp(this.taskRect,this.dependentTask,this.tasks,this.dateInfo,this.allTasks)})),a+=1,s.subTask&&s.subTask.length>0&&(a+=s.subTask.length)}))}throttle(t,e){let n;return function(){const a=arguments,s=this;n||(t.apply(s,a),n=!0,setTimeout((()=>n=!1),e))}}isExceedingDepenentEndDate(t,e,n){const a=n.filter((t=>e.dependencies.includes(t.id))).map((t=>new Date(t.end)));return new Date(Math.max(...a))>t?1:0}handleDragMove(t,e,n,a,s,i=null){t.preventDefault(),this.isDragging&&this.updateTaskBarPosition(t.clientX,e,n,a,s,i)}startDrag(t,e,n,a,s,i=null){this.dependentTask=a,this.tasks=s,this.allTasks=i,document.body.classList.add("dragging"),this.isDragging=!0,this.initialX=t.clientX,this.initialWidth=parseFloat(e.getAttribute("width")),this.isDragStart=t.clientX<e.getBoundingClientRect().left+this.initialWidth/2,this.currentTaskRect=e,this.currentProgressRect=n,this.dragMoveListener=this.throttle((t=>{this.handleDragMove(t,this.currentTaskRect,this.currentProgressRect,a,s,i)}),16),t.preventDefault(),document.addEventListener("mousemove",this.dragMoveListener)}updateTaskBarPosition(t,e,n,a,i,r){const d=.73*(t-this.initialX);if(this.isDragStart){const t=(new Date(a.start)-this.dateInfo.startingDate)/864e5*50+d,o=new Date(this.dateInfo.startingDate.getTime()+parseFloat(e.getAttribute("x"))/50*864e5);if(this.isExceedingDepenentEndDate(o,a,i)){alert("Start Date has exceeded its dependent EndDate"),document.body.classList.remove("dragging"),this.isDragging=!1;const t=i.findIndex((t=>t.id===a.id));if(-1!==t){const n=new Date(o.getTime()+parseFloat(e.getAttribute("width"))/52*864e5);i[t].start=o.toISOString().split("T")[0],i[t].end=n.toISOString().split("T")[0],s(i),r?this.createGanttChart(r):this.createGanttChart(i)}}const u=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width")),c=u-Math.min(t,u);e.setAttribute("x",t),e.setAttribute("width",c),n.setAttribute("x",t),n.setAttribute("width",c*a.progress/100)}else{const t=this.initialWidth+d;e.setAttribute("width",t),n.setAttribute("width",t*a.progress/100)}this.taskRect=e}handleMouseUp(t,e,n,a,i=null){if(document.body.classList.remove("dragging"),this.isDragging){this.isDragging=!1;const r=n.findIndex((t=>t.id===e.id));if(-1!==r){const e=new Date(a.startingDate.getTime()+parseFloat(t.getAttribute("x"))/50*864e5),d=new Date(e.getTime()+parseFloat(t.getAttribute("width"))/50*864e5);n[r].start=e.toISOString().split("T")[0],n[r].end=d.toISOString().split("T")[0],s(n),i?this.createGanttChart(i):this.createGanttChart(n)}}}updateGanttChartContent(t,s){for(;t.firstChild;)t.removeChild(t.firstChild);this.length=this.getTotalLength(s),this.dateInfo=this.calculateDateInfo(s);const i=this.calculateChartWidth(this.dateInfo),r=document.createElementNS(p,"g");r.setAttribute("class","date-groups"),t.appendChild(r),t.setAttribute("viewBox",`0 0 ${i} ${40*this.length+40}`),e(r,i,this.length),n(r,this.dateInfo,i),a(r,this.dateInfo,i,this.length),this.createTaskBars(t,s,this.dateInfo)}static createChart(t){(new g).createGanttChart(t)}static stopDrag(){document.removeEventListener("mousemove",this.dragMoveListener)}}return g}();
//# sourceMappingURL=gantt.min.js.map
