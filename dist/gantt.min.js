var Gantt=function(){"use strict";const t="http://www.w3.org/2000/svg";function e(e,n,s){const a=document.createElementNS(t,"g");a.classList.add("lines"),e.appendChild(a);for(let e=0;e<=n;e+=50){const n=document.createElementNS(t,"line");n.setAttribute("x1",e),n.setAttribute("x2",e),n.setAttribute("y1",35),n.setAttribute("y2",40*s+40),n.classList.add("grid-line"),a.appendChild(n)}}function n(e,n,s){const a=document.createElementNS(t,"g");a.classList.add("month"),e.appendChild(a);const i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let r=-1;for(let e=0;e<=s;e+=50){const s=new Date(n.startingDate.getTime()+e/50*864e5).getMonth();if(s!==r){r=s;const n=document.createElementNS(t,"text");n.setAttribute("x",e),n.setAttribute("y",10),n.classList.add("month-heading"),n.textContent=i[r],a.appendChild(n)}}}function s(e,n,s,a){const i=document.createElementNS(t,"g");e.appendChild(i),i.classList.add("date");const r=document.createElementNS(t,"text");r.setAttribute("x","0"),r.setAttribute("y",a),i.appendChild(r);const d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let e=0;e<=s;e+=50){const s=new Date(n.startingDate.getTime()+e/50*864e5),a=document.createElementNS(t,"text");a.setAttribute("x",e-3),a.setAttribute("y",25),a.setAttribute("font-size","12px"),0!==s.getDay()&&6!==s.getDay()||a.setAttribute("fill","red"),a.textContent=d[s.getDay()],i.appendChild(a)}}function a(t,e,n){const s=document.createElement("div");s.setAttribute("id","div-date"),s.classList.add("date");const a=document.createElement("div");a.setAttribute("x","0"),a.setAttribute("y",n),s.appendChild(a);const i=b.returnWidth();for(let n=0;n<=e;n+=50){const a=new Date(t.startingDate.getTime()+n/50*864e5),r=document.createElement("div");r.setAttribute("font-size","10px"),r.setAttribute("y",30),r.textContent=`${a.getDate()}`,0===a.getDay()||6===a.getDay()?r.setAttribute("style",`position:absolute;left:${n*i/e-5}px;color:red`):r.setAttribute("style",`position:absolute;left:${n*i/e-5}px`),s.appendChild(r)}return console.log("width",i),s}const i=t=>{const e=new Map(t.map((t=>[t.id,t])));t.forEach((t=>{r(t,e),function(t){if(t.subTask&&t.subTask.length>0){const e=new Map(t.subTask.map((t=>[t.id,t])));t.subTask.forEach((n=>{const s=(new Date(n.end)-new Date(n.start))/864e5;new Date(n.start)<new Date(t.start)&&(n.start=t.start,n.end=new Date(new Date(n.start).setDate(new Date(t.start).getDate()+s)).toISOString().split("T")[0]),r(n,e),n.end>t.end&&(t.end=n.end)}))}}(t)}))};function r(t,e){if(0===t.dependencies.length)return;const n=t.dependencies.map((t=>e.get(t))),s=new Date(Math.max(...n.map((t=>new Date(t.end)))));n.forEach((n=>{r(n,e);const a=(new Date(t.end)-new Date(t.start))/864e5;new Date(t.start)<s&&(t.start=s.toISOString().split("T")[0],t.end=new Date(new Date(t.start).setDate(new Date(t.start).getDate()+a)).toISOString().split("T")[0])}))}const d=document.createElement("div");function o(t){t.style.display="none"}function u(t){let e=document.getElementById("addFormModal");e||(e=document.createElement("div"),e.setAttribute("id","addFormModal"),e.setAttribute("class","modal"),document.body.appendChild(e));let n=document.getElementById("addTaskForm");n||(n=document.createElement("form"),n.setAttribute("id","addTaskForm"),e.appendChild(n)),n.innerHTML="",c("Task Name:","taskName","","text",!0,n),c("Start Date:","startDate","","date",!0,n),c("End Date:","endDate","","date",!0,n),c("Progress:","progress","","number",!0,n);const s=document.createElement("button");s.setAttribute("type","button"),s.textContent="Save Changes",s.addEventListener("click",(function(){!function(t){const e=document.getElementById("addFormModal"),n=document.getElementById("taskName").value,s=document.getElementById("startDate").value,a=document.getElementById("endDate").value;if(!n||!s||!a)return void alert("Please fill in all fields.");const i={id:t.length+1,name:n,start:s,end:a,progress:0,dependencies:[]};t.push(i),length+=1,o(e),b.createChart(t)}(t)})),n.appendChild(s);const a=document.createElement("button");a.setAttribute("type","button"),a.textContent="Cancel",a.addEventListener("click",(function(){o(e)})),n.appendChild(a),e.style.display="block",event.preventDefault()}function l(t,e,n,s=null){t.preventDefault(),b.stopDrag();let a=document.getElementById("editModal");a||(a=document.createElement("div"),a.setAttribute("id","editModal"),a.setAttribute("class","modal"),document.body.appendChild(a));let r=document.getElementById("editTaskForm");r||(r=document.createElement("form"),r.setAttribute("id","editTaskForm"),a.appendChild(r)),r.innerHTML="",c("Task Name:","editTaskName",e.name,"text",!0,r),c("Start Date:","editStartDate",e.start,"date",!0,r),c("End Date:","editEndDate",e.end,"date",!0,r),c("Progress:","editProgress",e.progress,"number",!0,r);const d=document.createElement("select");d.setAttribute("id","editDependencies"),d.setAttribute("multiple","multiple"),r.appendChild(d),n.forEach((t=>{if(t.id!==e.id&&!h(e,t,n)){const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.dependencies.includes(t.id)&&(n.selected=!0),d.appendChild(n)}})),r.setAttribute("data-task-id",e.id);const u=document.createElement("button");u.setAttribute("type","button"),u.textContent="Save Changes",u.addEventListener("click",(function(){!function(t,e=null){const n=document.getElementById("editTaskForm"),s=document.getElementById("editTaskName"),a=document.getElementById("editStartDate"),r=document.getElementById("editEndDate"),d=document.getElementById("editProgress"),o=document.getElementById("editDependencies"),u=s.value,l=a.value,c=r.value,h=d.value,p=parseInt(n.getAttribute("data-task-id"),10),m=Array.from(o.selectedOptions).map((t=>parseInt(t.value,10))),g=t.findIndex((t=>t.id===p));-1!==g&&(t[g].name=u,t[g].start=l,t[g].end=c,t[g].progress=h>100?100:h,t[g].dependencies=m);i(t),e?b.createChart(e):b.createChart(t)}(n,s),o(a)})),r.appendChild(u);const l=document.createElement("button");l.setAttribute("type","button"),l.textContent="Cancel",l.addEventListener("click",(function(){o(a)})),r.appendChild(l),a.style.display="block",t.preventDefault()}function c(t,e,n,s,a,i){const r=document.createElement("label");r.setAttribute("for",e),r.textContent=t;const d=document.createElement("input");d.setAttribute("type",s),d.setAttribute("id",e),d.setAttribute("name",e),d.value=n,d.required=a,i.appendChild(r),i.appendChild(d)}function h(t,e,n){return e.dependencies.includes(t.id)||e.dependencies.some((e=>h(t,n[e-1],n)))}function p(t,e){const n=t.dependencies.map((t=>e[t-1].name)),s=n.length>0?`Dependencies: ${n.join(", ")}`:"";d.innerHTML=`\n    Task: ${t.name}<br>\n    Start: ${t.start}<br>\n    End: ${t.end}<br>\n    ${s}\n    `,d.style.left=`${event.pageX}px`,d.style.top=`${event.pageY}px`,d.style.display="block"}function m(){d.style.display="none"}d.className="bar-hover",document.body.appendChild(d);const g="http://www.w3.org/2000/svg";class b{constructor(){this.dateInfo,this.taskCount,this.isDragging=!1,this.initialX,this.initialWidth,this.isDragStart,this.currentTaskRect,this.currentProgressRect,this.dragMoveListener=null,this.length,this.dependentTask,this.tasks,this.allTask,this.chartWidth}getTotalLength(t){return t.reduce(((t,e)=>t+1+(e.subTask?this.getTotalLength(e.subTask):0)),0)}createButton(t){const e=document.createElement("button");return e.setAttribute("class","top-place add-button"),e.textContent="Add Task",e.addEventListener("click",(()=>{u(t)})),e}createGanttChart(t){i(t);const e=document.getElementById("chart"),n=this.createButton(t);let s=e.querySelector("svg");if(s)this.updateGanttChartContent(s,t);else{e.appendChild(n),s=this.createSVG(t),e.appendChild(s);const i=a(this.dateInfo,this.chartWidth,this.length);e.insertBefore(i,s),console.log(i)}}createSVG(t){const a=document.createElementNS(g,"svg");a.setAttribute("id","mySvg"),a.setAttribute("min-width","100%"),a.setAttribute("height","200%");const i=document.createElementNS(g,"g");i.setAttribute("class","date-groups"),a.appendChild(i),this.dateInfo=this.calculateDateInfo(t);const r=this.calculateChartWidth(this.dateInfo);return this.length=this.getTotalLength(t),a.setAttribute("viewBox",`0 0 ${r} ${40*this.length+40}`),e(i,r,this.length),n(i,this.dateInfo,r),s(i,this.dateInfo,r,this.length),this.createTaskBars(a,t,this.dateInfo),setTimeout((()=>{this.drawDependencyLine(a,t)}),0),a}calculateDateInfo(t){const e=t.map((t=>new Date(t.start))),n=t.map((t=>new Date(t.end))),s=new Date(Math.min(...e)),a=new Date(s);a.setDate(s.getDate()-5);const i=new Date(Math.max(...n)),r=(i-s)/864e5;return{startingDate:a,maxDate:i,multiplier:r>100?54:r>30?60:120}}calculateChartWidth(t){return this.chartWidth=(t.maxDate-t.startingDate)/864e5*t.multiplier,this.chartWidth}createTaskBars(t,e,n){let s=0;e.forEach(((a,i)=>{const r=document.createElementNS(g,"g");r.setAttribute("class","tasks"),t.appendChild(r);const d=Math.max(...a.dependencies.map((t=>new Date(e[t-1].end)))),o=Math.max((d-n.startingDate)/864e5*50,(new Date(a.start)-n.startingDate)/864e5*50),u=(new Date(a.end)-new Date(a.start))/864e5*50,c=document.createElementNS(g,"rect");c.setAttribute("x",o),c.setAttribute("y",40*s+40),c.setAttribute("width",u),c.setAttribute("height",30),c.setAttribute("fill","#3498db"),c.setAttribute("id",`task-${a.id}`),r.appendChild(c);const h=u*a.progress/100,b=document.createElementNS(g,"rect");b.setAttribute("x",o),b.setAttribute("y",40*s+40),b.setAttribute("width",h),b.setAttribute("height",30),b.setAttribute("fill","#2ecc71"),r.appendChild(b);const A=document.createElementNS(g,"text");if(A.setAttribute("x",o+5),A.setAttribute("y",40*s+60),A.textContent=a.name,r.appendChild(A),a.subTask&&a.subTask.length>0){const t=document.createElementNS(g,"g");t.setAttribute("class","subtask"),r.appendChild(t),a.subTask.forEach(((i,r)=>{const d=Math.max(...i.dependencies.map((t=>new Date(a.subTask[t-1].end)))),o=Math.max((d-n.startingDate)/864e5*50,(new Date(i.start)-n.startingDate)/864e5*50),u=(new Date(i.end)-new Date(i.start))/864e5*50,c=document.createElementNS(g,"rect");c.setAttribute("class","subtask"),c.setAttribute("x",o),c.setAttribute("y",40*(r+s+1)+40),c.setAttribute("width",u),c.setAttribute("height",15),c.setAttribute("fill","#e74c3c"),c.setAttribute("id",`subtask-${a.id}-${i.id}`),t.appendChild(c);const h=u*i.progress/100,b=document.createElementNS(g,"rect");b.setAttribute("class","subtask-progress"),b.setAttribute("x",o),b.setAttribute("y",40*(r+s+1)+40),b.setAttribute("width",h),b.setAttribute("height",15),b.setAttribute("fill","#c0392b"),t.appendChild(b);const A=document.createElementNS(g,"text");A.setAttribute("x",o+5),A.setAttribute("y",40*(r+s+1)+50),A.textContent=i.name,A.setAttribute("font-size","10px"),t.appendChild(A),A.addEventListener("mouseover",(()=>p(i,a.subTask))),c.addEventListener("mouseover",(()=>p(i,a.subTask))),c.addEventListener("mouseout",m),b.addEventListener("mouseover",(()=>p(i,a.subTask))),b.addEventListener("mouseout",m),c.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,i,a.subTask,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,i,a.subTask,e)})),A.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,i,a.subTask,e)})),c.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,i,a.subTask,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,i,a.subTask,e)})),A.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,i,a.subTask,e)}))}))}A.addEventListener("mouseover",(()=>p(a,e))),c.addEventListener("mouseover",(()=>p(a,e))),c.addEventListener("mouseout",m),b.addEventListener("mouseover",(()=>p(a,e))),b.addEventListener("mouseout",m),c.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,a,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,a,e)})),A.addEventListener("contextmenu",(t=>{t.preventDefault(),l(t,a,e)})),c.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,a,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,a,e)})),A.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,c,b,a,e)})),document.addEventListener("mouseup",(t=>{this.handleMouseUp(this.taskRect,this.dependentTask,this.tasks,this.dateInfo,this.allTasks)})),s+=1,a.subTask&&a.subTask.length>0&&(s+=a.subTask.length)}))}throttle(t,e){let n;return function(){const s=arguments,a=this;n||(t.apply(a,s),n=!0,setTimeout((()=>n=!1),e))}}isExceedingDepenentEndDate(t,e,n){const s=n.filter((t=>e.dependencies.includes(t.id))).map((t=>new Date(t.end)));return new Date(Math.max(...s))>t?1:0}handleDragMove(t,e,n,s,a,i=null){t.preventDefault(),this.isDragging&&this.updateTaskBarPosition(t.clientX,e,n,s,a,i)}startDrag(t,e,n,s,a,i=null){this.dependentTask=s,this.tasks=a,this.allTasks=i,document.body.classList.add("dragging"),this.isDragging=!0,this.initialX=t.clientX,this.initialWidth=parseFloat(e.getAttribute("width")),this.isDragStart=t.clientX<e.getBoundingClientRect().left+this.initialWidth/2,this.currentTaskRect=e,this.currentProgressRect=n,this.dragMoveListener=this.throttle((t=>{this.handleDragMove(t,this.currentTaskRect,this.currentProgressRect,s,a,i)}),16),t.preventDefault(),document.addEventListener("mousemove",this.dragMoveListener)}updateTaskBarPosition(t,e,n,s,a,r){const d=this.getWidth(),o=(t-this.initialX)/(d/this.chartWidth);if(this.isDragStart){const t=(new Date(s.start)-this.dateInfo.startingDate)/864e5*50+o,d=new Date(this.dateInfo.startingDate.getTime()+parseFloat(e.getAttribute("x"))/50*864e5);if(this.isExceedingDepenentEndDate(d,s,a)){alert("Start Date has exceeded its dependent EndDate"),document.body.classList.remove("dragging"),this.isDragging=!1;const t=a.findIndex((t=>t.id===s.id));if(-1!==t){const n=new Date(d.getTime()+parseFloat(e.getAttribute("width"))/51*864e5);a[t].start=d.toISOString().split("T")[0],a[t].end=n.toISOString().split("T")[0],document.removeEventListener("mousemove",this.dragMoveListener),i(a),r?this.createGanttChart(r):this.createGanttChart(a)}}const u=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width")),l=u-Math.min(t,u);e.setAttribute("x",t),e.setAttribute("width",l),n.setAttribute("x",t),n.setAttribute("width",l*s.progress/100)}else{const t=this.initialWidth+o;e.setAttribute("width",t),n.setAttribute("width",t*s.progress/100)}this.taskRect=e}handleMouseUp(t,e,n,s,a=null){if(document.body.classList.remove("dragging"),document.removeEventListener("mousemove",this.dragMoveListener),this.isDragging){this.isDragging=!1;const r=n.findIndex((t=>t.id===e.id));if(-1!==r){const e=new Date(s.startingDate.getTime()+parseFloat(t.getAttribute("x"))/50*864e5),d=new Date(e.getTime()+parseFloat(t.getAttribute("width"))/50*864e5);n[r].start=e.toISOString().split("T")[0],n[r].end=d.toISOString().split("T")[0],i(n),a?this.createGanttChart(a):this.createGanttChart(n)}}}updateGanttChartContent(t,i){const r=document.getElementById("chart");let d=document.getElementById("div-date");for(r.removeChild(d);t.firstChild;)t.removeChild(t.firstChild);this.length=this.getTotalLength(i),this.dateInfo=this.calculateDateInfo(i);const o=this.calculateChartWidth(this.dateInfo),u=document.createElementNS(g,"g");u.setAttribute("class","date-groups"),t.appendChild(u),t.setAttribute("viewBox",`0 0 ${o} ${40*this.length+40}`),e(u,o,this.length),n(u,this.dateInfo,o),s(u,this.dateInfo,o,this.length),d=a(this.dateInfo,this.chartWidth,this.length),r.insertBefore(d,t),this.createTaskBars(t,i,this.dateInfo),this.drawDependencyLine(t,i)}drawDependencyLine(t,e){e.forEach(((n,s)=>{n.dependencies&&n.dependencies.length>0&&n.dependencies.forEach((s=>{const a=e.find((t=>t.id===s));if(a){const e="http://www.w3.org/2000/svg",s=document.getElementById(`task-${a.id}`),i=document.getElementById(`task-${n.id}`);if(s&&i){const n=parseFloat(s.getAttribute("width"))+parseFloat(s.getAttribute("x")),a=parseFloat(s.getAttribute("y")),r=parseFloat(i.getAttribute("x"))+parseFloat(i.getAttribute("width"))/2,d=document.createElementNS(e,"line");d.setAttribute("x1",n),d.setAttribute("y1",a+parseFloat(i.getAttribute("height"))/2),d.setAttribute("x2",r),d.setAttribute("y2",a+parseFloat(i.getAttribute("height"))/2),d.classList.add("dependency-line"),t.appendChild(d);const o=document.createElementNS(e,"line");o.setAttribute("x1",r),o.setAttribute("y1",a+parseFloat(i.getAttribute("height"))/2),o.setAttribute("x2",r),o.setAttribute("y2",parseFloat(i.getAttribute("y"))),o.classList.add("dependency-line"),t.appendChild(o);const u=document.createElementNS(e,"polygon"),l=5;u.setAttribute("points",`${r},${parseFloat(i.getAttribute("y"))-l} ${r-l},${parseFloat(i.getAttribute("y"))-l} ${r},${parseFloat(i.getAttribute("y"))} ${r+l},${parseFloat(i.getAttribute("y"))-l}`),u.classList.add("dependency-arrowhead"),t.appendChild(u)}}})),n.subTask&&n.subTask.forEach(((e,s)=>{e.dependencies&&e.dependencies.length>0&&e.dependencies.forEach((s=>{const a=n.subTask.find((t=>t.id===s));if(a){const s="http://www.w3.org/2000/svg",i=document.getElementById(`subtask-${n.id}-${a.id}`),r=document.getElementById(`subtask-${n.id}-${e.id}`);if(i&&r){const e=parseFloat(i.getAttribute("width"))+parseFloat(i.getAttribute("x")),n=parseFloat(i.getAttribute("y")),a=parseFloat(r.getAttribute("x"))+parseFloat(r.getAttribute("width"))/2,d=document.createElementNS(s,"line");d.setAttribute("x1",e),d.setAttribute("y1",n+parseFloat(r.getAttribute("height"))/2),d.setAttribute("x2",a),d.setAttribute("y2",n+parseFloat(r.getAttribute("height"))/2),d.classList.add("dependency-line"),t.appendChild(d);const o=document.createElementNS(s,"line");o.setAttribute("x1",a),o.setAttribute("y1",n+parseFloat(r.getAttribute("height"))/2),o.setAttribute("x2",a),o.setAttribute("y2",parseFloat(r.getAttribute("y"))),o.classList.add("dependency-line"),t.appendChild(o);const u=document.createElementNS(s,"polygon"),l=5;u.setAttribute("points",`${a},${parseFloat(r.getAttribute("y"))-l} ${a-l},${parseFloat(r.getAttribute("y"))-l} ${a},${parseFloat(r.getAttribute("y"))} ${a+l},${parseFloat(r.getAttribute("y"))-l}`),u.classList.add("dependency-arrowhead"),t.appendChild(u)}}}))}))}))}getWidth(){var t=document.getElementById("mySvg");if(t){var e=window.getComputedStyle(t).width;return parseFloat(e)}return null}static returnWidth(){return(new b).getWidth()}static createChart(t){(new b).createGanttChart(t)}static stopDrag(){document.removeEventListener("mousemove",this.dragMoveListener)}}return b}();
//# sourceMappingURL=gantt.min.js.map
