var Gantt=function(){"use strict";const t="http://www.w3.org/2000/svg";function e(e,n,s){const a=document.createElementNS(t,"g");a.classList.add("lines"),e.appendChild(a);for(let e=0;e<=n;e+=50){const n=document.createElementNS(t,"line");n.setAttribute("x1",e),n.setAttribute("x2",e),n.setAttribute("y1",35),n.setAttribute("y2",40*s+40),n.classList.add("grid-line"),a.appendChild(n)}}function n(e,n,s){const a=document.createElementNS(t,"g");a.classList.add("month"),e.appendChild(a);const i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let r=-1;for(let e=0;e<=s;e+=50){const s=new Date(n.startingDate.getTime()+e/50*864e5).getMonth();if(s!==r){r=s;const n=document.createElementNS(t,"text");n.setAttribute("x",e),n.setAttribute("y",15),n.classList.add("month-heading"),n.textContent=i[r],a.appendChild(n)}}}function s(e,n,s,a){const i=document.createElementNS(t,"g");e.appendChild(i),i.classList.add("date");const r=document.createElementNS(t,"text");r.setAttribute("x","0"),r.setAttribute("y",a),i.appendChild(r);for(let e=0;e<=s;e+=50){const s=new Date(n.startingDate.getTime()+e/50*864e5),r=document.createElementNS(t,"text");r.setAttribute("x",e-3),r.setAttribute("y",a+25),r.textContent=s.getDate(),i.appendChild(r)}}const a=t=>{const e=new Map(t.map((t=>[t.id,t])));t.forEach((t=>{i(t,e),function(t){if(t.subTask&&t.subTask.length>0){const e=new Map(t.subTask.map((t=>[t.id,t])));t.subTask.forEach((n=>{const s=(new Date(n.end)-new Date(n.start))/864e5;if(new Date(n.start)<new Date(t.start))n.start=t.start,n.end=new Date(new Date(n.start).setDate(new Date(t.start).getDate()+s)).toISOString().split("T")[0];else{const e=(new Date(n.start)-new Date(t.start))/864e5;n.start=new Date(new Date(n.start).setDate(new Date(t.start).getDate()+e)).toISOString().split("T")[0]}i(n,e),n.end>t.end&&(t.end=n.end)}))}}(t)}))};function i(t,e){if(0===t.dependencies.length)return;const n=t.dependencies.map((t=>e.get(t))),s=new Date(Math.max(...n.map((t=>new Date(t.end)))));n.forEach((n=>{i(n,e);const a=(new Date(t.end)-new Date(t.start))/864e5;new Date(t.start)<s&&(t.start=s.toISOString().split("T")[0],t.end=new Date(new Date(t.start).setDate(new Date(t.start).getDate()+a)).toISOString().split("T")[0])}))}const r=document.createElement("div");function d(){document.getElementById("editModal").style.display="none"}function o(t,e,n,s=null){t.preventDefault(),g.stopDrag();let i=document.getElementById("editModal");i||(i=document.createElement("div"),i.setAttribute("id","editModal"),i.setAttribute("class","modal"),document.body.appendChild(i));let r=document.getElementById("editTaskForm");r||(r=document.createElement("form"),r.setAttribute("id","editTaskForm"),i.appendChild(r)),r.innerHTML="",u("Task Name:","editTaskName",e.name,"text",!0),u("Start Date:","editStartDate",e.start,"date",!0),u("End Date:","editEndDate",e.end,"date",!0),u("Progress:","editProgress",e.progress,"number",!0);const o=document.createElement("select");o.setAttribute("id","editDependencies"),o.setAttribute("multiple","multiple"),r.appendChild(o),n.forEach((t=>{if(t.id!==e.id&&!c(e,t,n)){const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.dependencies.includes(t.id)&&(n.selected=!0),o.appendChild(n)}})),r.setAttribute("data-task-id",e.id);const l=document.createElement("button");l.setAttribute("type","button"),l.textContent="Save Changes",l.addEventListener("click",(function(){!function(t,e=null){const n=document.getElementById("editTaskForm"),s=document.getElementById("editTaskName"),i=document.getElementById("editStartDate"),r=document.getElementById("editEndDate"),o=document.getElementById("editProgress"),u=document.getElementById("editDependencies"),c=s.value,l=i.value,h=r.value,m=o.value,p=parseInt(n.getAttribute("data-task-id"),10),D=Array.from(u.selectedOptions).map((t=>parseInt(t.value,10))),b=t.findIndex((t=>t.id===p));-1!==b&&(t[b].name=c,t[b].start=l,t[b].end=h,t[b].progress=m>100?100:m,t[b].dependencies=D);a(t),console.log(t),e?g.createChart(e):g.createChart(t);d()}(n,s),d()})),r.appendChild(l);const h=document.createElement("button");h.setAttribute("type","button"),h.textContent="Cancel",h.addEventListener("click",d),r.appendChild(h),i.style.display="block",t.preventDefault()}function u(t,e,n,s,a){const i=document.createElement("label");i.setAttribute("for",e),i.textContent=t;const r=document.createElement("input");r.setAttribute("type",s),r.setAttribute("id",e),r.setAttribute("name",e),r.value=n,r.required=a,editTaskForm.appendChild(i),editTaskForm.appendChild(r)}function c(t,e,n){return e.dependencies.includes(t.id)||e.dependencies.some((e=>c(t,n[e-1],n)))}function l(t,e){const n=t.dependencies.map((t=>e[t-1].name)),s=n.length>0?`Dependencies: ${n.join(", ")}`:"";r.innerHTML=`\n    Task: ${t.name}<br>\n    Start: ${t.start}<br>\n    End: ${t.end}<br>\n    ${s}\n    `,r.style.left=`${event.pageX}px`,r.style.top=`${event.pageY}px`,r.style.display="block"}function h(){r.style.display="none"}r.className="bar-hover",document.body.appendChild(r);const m="http://www.w3.org/2000/svg";class g{constructor(){this.dateInfo,this.taskCount,this.isDragging=!1,this.initialX,this.initialWidth,this.isDragStart,this.currentTaskRect,this.currentProgressRect,this.dragMoveListener=null,this.length,this.dependentTask,this.tasks,this.allTask}getTotalLength(t){return t.reduce(((t,e)=>t+1+(e.subTask?this.getTotalLength(e.subTask):0)),0)}createGanttChart(t){a(t);const e=document.getElementById("chart");let n=e.querySelector("svg");n?this.updateGanttChartContent(n,t):(n=this.createSVG(t),e.appendChild(n))}createSVG(t){const a=document.createElementNS(m,"svg");a.setAttribute("min-width","100%"),a.setAttribute("height","200%");const i=document.createElementNS(m,"g");i.setAttribute("class","date-groups"),a.appendChild(i),this.dateInfo=this.calculateDateInfo(t);const r=this.calculateChartWidth(this.dateInfo);return this.length=this.getTotalLength(t),a.setAttribute("viewBox",`0 0 ${r} ${40*this.length+40}`),e(i,r,this.length),n(i,this.dateInfo,r),s(i,this.dateInfo,r,this.length),this.createTaskBars(a,t,this.dateInfo),a}calculateDateInfo(t){const e=t.map((t=>new Date(t.start))),n=t.map((t=>new Date(t.end))),s=new Date(Math.min(...e)),a=new Date(s);a.setDate(s.getDate()-5);const i=new Date(Math.max(...n)),r=(i-s)/864e5;return{startingDate:a,maxDate:i,multiplier:r>100?54:r>30?60:120}}calculateChartWidth(t){return t.multiplier*((t.maxDate-t.startingDate)/864e5)}createTaskBars(t,e,n){let s=0;e.forEach(((a,i)=>{const r=document.createElementNS(m,"g");r.setAttribute("class","tasks"),t.appendChild(r);const d=Math.max(...a.dependencies.map((t=>new Date(e[t-1].end)))),u=Math.max((d-n.startingDate)/864e5*50,(new Date(a.start)-n.startingDate)/864e5*50),c=(new Date(a.end)-new Date(a.start))/864e5*50,g=document.createElementNS(m,"rect");g.setAttribute("x",u),g.setAttribute("y",40*s+40),g.setAttribute("width",c),g.setAttribute("height",30),g.setAttribute("fill","#3498db"),r.appendChild(g);const p=c*a.progress/100,D=document.createElementNS(m,"rect");D.setAttribute("x",u),D.setAttribute("y",40*s+40),D.setAttribute("width",p),D.setAttribute("height",30),D.setAttribute("fill","#2ecc71"),r.appendChild(D);const b=document.createElementNS(m,"text");if(b.setAttribute("x",u+5),b.setAttribute("y",40*s+60),b.textContent=a.name,r.appendChild(b),a.subTask&&a.subTask.length>0){const t=document.createElementNS(m,"g");t.setAttribute("class","subtask"),r.appendChild(t),a.subTask.forEach(((i,r)=>{const d=Math.max(...i.dependencies.map((t=>new Date(a.subTask[t-1].end)))),u=Math.max((d-n.startingDate)/864e5*50,(new Date(i.start)-n.startingDate)/864e5*50),c=(new Date(i.end)-new Date(i.start))/864e5*50,g=document.createElementNS(m,"rect");g.setAttribute("class","subtask"),g.setAttribute("x",u),g.setAttribute("y",40*(r+s+1)+40),g.setAttribute("width",c),g.setAttribute("height",15),g.setAttribute("fill","#e74c3c"),t.appendChild(g);const p=c*i.progress/100,D=document.createElementNS(m,"rect");D.setAttribute("class","subtask-progress"),D.setAttribute("x",u),D.setAttribute("y",40*(r+s+1)+40),D.setAttribute("width",p),D.setAttribute("height",15),D.setAttribute("fill","#c0392b"),t.appendChild(D);const b=document.createElementNS(m,"text");b.setAttribute("x",u+5),b.setAttribute("y",40*(r+s+1)+50),b.textContent=i.name,b.setAttribute("font-size","10px"),t.appendChild(b),b.addEventListener("mouseover",(()=>l(i,a.subTask))),g.addEventListener("mouseover",(()=>l(i,a.subTask))),g.addEventListener("mouseout",h),D.addEventListener("mouseover",(()=>l(i,a.subTask))),D.addEventListener("mouseout",h),g.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,i,a.subTask,e)})),D.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,i,a.subTask,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,i,a.subTask,e)})),g.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,i,a.subTask,e)})),D.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,i,a.subTask,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,i,a.subTask,e)}))}))}b.addEventListener("mouseover",(()=>l(a,e))),g.addEventListener("mouseover",(()=>l(a,e))),g.addEventListener("mouseout",h),D.addEventListener("mouseover",(()=>l(a,e))),D.addEventListener("mouseout",h),g.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,a,e)})),D.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,a,e)})),b.addEventListener("contextmenu",(t=>{t.preventDefault(),o(t,a,e)})),g.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,a,e)})),D.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,a,e)})),b.addEventListener("mousedown",(t=>{t.preventDefault(),this.startDrag(t,g,D,a,e)})),document.addEventListener("mouseup",(t=>{document.removeEventListener("mousemove",this.dragMoveListener),this.handleMouseUp(this.taskRect,this.dependentTask,this.tasks,this.dateInfo,this.allTasks)})),s+=1,a.subTask&&a.subTask.length>0&&(s+=a.subTask.length)}))}throttle(t,e){let n;return function(){const s=arguments,a=this;n||(t.apply(a,s),n=!0,setTimeout((()=>n=!1),e))}}isExceedingDepenentEndDate(t,e,n){const s=n.filter((t=>e.dependencies.includes(t.id))).map((t=>new Date(t.end)));return new Date(Math.max(...s))>t?1:0}handleDragMove(t,e,n,s,a,i=null){t.preventDefault(),this.isDragging&&this.updateTaskBarPosition(t.clientX,e,n,s,a,i)}startDrag(t,e,n,s,a,i=null){this.dependentTask=s,this.tasks=a,this.allTasks=i,document.body.classList.add("dragging"),this.isDragging=!0,this.initialX=t.clientX,this.initialWidth=parseFloat(e.getAttribute("width")),this.isDragStart=t.clientX<e.getBoundingClientRect().left+this.initialWidth/2,this.currentTaskRect=e,this.currentProgressRect=n,this.dragMoveListener=this.throttle((t=>{this.handleDragMove(t,this.currentTaskRect,this.currentProgressRect,s,a,i)}),16),t.preventDefault(),document.addEventListener("mousemove",this.dragMoveListener)}updateTaskBarPosition(t,e,n,s,i,r){const d=.73*(t-this.initialX);if(this.isDragStart){const t=(new Date(s.start)-this.dateInfo.startingDate)/864e5*50+d,o=new Date(this.dateInfo.startingDate.getTime()+parseFloat(e.getAttribute("x"))/50*864e5);if(this.isExceedingDepenentEndDate(o,s,i)){alert("Start Date has exceeded its dependent EndDate"),document.body.classList.remove("dragging"),this.isDragging=!1;const t=i.findIndex((t=>t.id===s.id));if(-1!==t){const n=new Date(o.getTime()+parseFloat(e.getAttribute("width"))/52*864e5);i[t].start=o.toISOString().split("T")[0],i[t].end=n.toISOString().split("T")[0],a(i),r?this.createGanttChart(r):this.createGanttChart(i)}}const u=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width")),c=u-Math.min(t,u);e.setAttribute("x",t),e.setAttribute("width",c),n.setAttribute("x",t),n.setAttribute("width",c*s.progress/100)}else{const t=this.initialWidth+d;e.setAttribute("width",t),n.setAttribute("width",t*s.progress/100)}this.taskRect=e}handleMouseUp(t,e,n,s,i=null){if(document.body.classList.remove("dragging"),this.isDragging){this.isDragging=!1;const r=n.findIndex((t=>t.id===e.id));if(-1!==r){const e=new Date(s.startingDate.getTime()+parseFloat(t.getAttribute("x"))/50*864e5),d=new Date(e.getTime()+parseFloat(t.getAttribute("width"))/50*864e5);n[r].start=e.toISOString().split("T")[0],n[r].end=d.toISOString().split("T")[0],a(n),i?this.createGanttChart(i):this.createGanttChart(n)}}}updateGanttChartContent(t,a){for(;t.firstChild;)t.removeChild(t.firstChild);this.length=this.getTotalLength(a),this.dateInfo=this.calculateDateInfo(a);const i=this.calculateChartWidth(this.dateInfo),r=document.createElementNS(m,"g");r.setAttribute("class","date-groups"),t.appendChild(r),t.setAttribute("viewBox",`0 0 ${i} ${40*this.length+40}`),e(r,i,this.length),n(r,this.dateInfo,i),s(r,this.dateInfo,i,this.length),this.createTaskBars(t,a,this.dateInfo)}static createChart(t){console.log(t);(new g).createGanttChart(t)}static stopDrag(){document.removeEventListener("mousemove",this.dragMoveListener)}}return g}();
//# sourceMappingURL=gantt.min.js.map
